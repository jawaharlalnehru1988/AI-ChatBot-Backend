# LiveKit Integration

This application now includes LiveKit integration for real-time video, audio, and AI-powered chat features.

## Features

### Basic LiveKit Features
- Create and manage video/audio rooms
- Generate access tokens for participants
- Join/leave rooms
- Remove participants
- Room and participant management
- Webhook handling for real-time events

### AI-Powered Features
- AI Assistant in video calls
- Real-time chat with OpenAI integration
- Meeting summaries generated by AI
- Persistent chat history per room
- Customizable AI system prompts

## API Endpoints

### LiveKit Basic Endpoints

#### Rooms
- `POST /livekit/rooms` - Create a new room
- `GET /livekit/rooms` - List all rooms
- `GET /livekit/rooms/:roomName` - Get room information
- `DELETE /livekit/rooms/:roomName` - Delete a room

#### Participants
- `GET /livekit/rooms/:roomName/participants` - List participants in a room
- `DELETE /livekit/rooms/:roomName/participants/:identity` - Remove a participant

#### Tokens
- `POST /livekit/token` - Create access token
- `POST /livekit/join` - Join a room (returns token and connection info)
- `POST /livekit/connection-info` - Get connection information

#### Webhooks
- `POST /livekit/webhook` - Handle LiveKit webhooks

### AI-LiveKit Integration Endpoints

#### AI Rooms
- `POST /ai-livekit/create-room` - Create room with AI assistant
- `POST /ai-livekit/join-room` - Join AI-enabled room

#### AI Chat
- `POST /ai-livekit/send-message` - Send message to AI assistant
- `GET /ai-livekit/rooms/:roomName/chat-history` - Get chat history
- `POST /ai-livekit/rooms/:roomName/clear-history` - Clear chat history
- `POST /ai-livekit/rooms/:roomName/summary` - Generate meeting summary

#### AI Webhooks
- `POST /ai-livekit/webhook` - Handle AI-enhanced webhooks

## Setup Instructions

### 1. LiveKit Server Setup

You need a LiveKit server instance. You can:

**Option A: Use LiveKit Cloud**
1. Sign up at [LiveKit Cloud](https://cloud.livekit.io/)
2. Create a new project
3. Get your API Key, Secret, and WebSocket URL

**Option B: Self-hosted LiveKit**
1. Follow [LiveKit Server installation guide](https://docs.livekit.io/deploy/)
2. Deploy your own LiveKit server
3. Configure your API credentials

### 2. Environment Variables

Add these to your `.env` file:

\`\`\`
LIVEKIT_URL=wss://your-livekit-server.com
LIVEKIT_API_KEY=your-api-key
LIVEKIT_API_SECRET=your-api-secret
\`\`\`

### 3. Vercel Environment Variables

In your Vercel dashboard, add the same environment variables:
- `LIVEKIT_URL`
- `LIVEKIT_API_KEY` 
- `LIVEKIT_API_SECRET`

## Usage Examples

### Creating an AI-Powered Room

\`\`\`javascript
// Create room with AI assistant
const response = await fetch('/ai-livekit/create-room', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    roomName: 'my-ai-meeting',
    participantName: 'John Doe',
    aiAssistantName: 'Meeting Assistant',
    systemPrompt: 'You are a helpful meeting assistant. Take notes and answer questions.'
  })
});

const { room, userToken, url } = await response.json();
\`\`\`

### Joining an AI Room

\`\`\`javascript
const response = await fetch('/ai-livekit/join-room', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    roomName: 'my-ai-meeting',
    participantName: 'Jane Smith'
  })
});

const { token, url, chatHistory } = await response.json();
\`\`\`

### Sending Message to AI

\`\`\`javascript
const response = await fetch('/ai-livekit/send-message', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    roomName: 'my-ai-meeting',
    message: 'Can you summarize what we discussed so far?',
    participantId: 'user-123'
  })
});

const { response: aiResponse } = await response.json();
\`\`\`

### Generating Meeting Summary

\`\`\`javascript
const response = await fetch('/ai-livekit/rooms/my-ai-meeting/summary', {
  method: 'POST'
});

const { summary } = await response.json();
\`\`\`

## Frontend Integration

To integrate this with your frontend, you'll need:

1. **LiveKit Client SDK**: Install the appropriate client SDK for your frontend framework
   - React: `@livekit/react-core`, `@livekit/react-components`
   - Vue: `@livekit/vue-core`
   - JavaScript: `livekit-client`

2. **WebSocket Connection**: Use the token and URL from the join endpoints to connect to LiveKit

3. **Chat Interface**: Build a chat UI that sends messages to your AI endpoints

## Security Considerations

1. **Token Validation**: Access tokens have expiration times
2. **Room Permissions**: Configure appropriate permissions per participant
3. **Webhook Verification**: In production, verify webhook signatures
4. **Rate Limiting**: Consider implementing rate limiting for AI chat endpoints
5. **CORS**: Configure CORS appropriately for your frontend domains

## Troubleshooting

### Common Issues

1. **Connection Failed**: Check your LIVEKIT_URL and credentials
2. **Token Invalid**: Ensure API key and secret are correct
3. **AI Not Responding**: Verify OpenAI API key is set and has quota
4. **WebSocket Issues**: Check CORS configuration and network firewall

### Debug Mode

Enable debug logging by setting `NODE_ENV=development` to see detailed logs.

## Next Steps

1. Implement frontend with LiveKit client SDK
2. Add authentication and user management
3. Implement room access controls
4. Add file sharing capabilities
5. Integrate screen sharing features
6. Add recording functionality